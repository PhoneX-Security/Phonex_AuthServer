<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:sec="http://www.springframework.org/security/tags"
      xmlns:c="http://java.sun.com/jsp/jstl/core">

<ui:composition>
    <div id="widecontent">
    <h:form id="cardForm">
        <div style="margin: 0 auto; width: 607px">
        <rich:graphValidator value="#{cardUploadBean}">
            <h:panelGrid id="panel1" columns="2" border="0" >
                <h:panelGrid id="cardData" columns="1" border="0" >
                    <h:outputLabel for="fname" value="${tran.FirstName}" />
                    <h:inputText id="fname" value="#{cardUploadBean.card.firstName}">
                        <f:validateRequired/>
                        <rich:validator/>
                    </h:inputText>

                    <h:outputLabel for="sname" value="${tran.Surname}" />
                    <h:inputText id="sname" value="#{cardUploadBean.card.secondName}">
                        <f:validateRequired/>
                        <rich:validator/>
                    </h:inputText>

                    <h:outputLabel for="company" value="${tran.Company}" />
                    <h:inputText id="company" value="#{cardUploadBean.card.company}" />

                    <h:outputLabel for="email" value="${tran.Email}" />
                    <h:inputText id="email" value="#{cardUploadBean.card.email}" >
                        <f:validateRegex
                                pattern="^(([a-zA-Z0-9_\-\.]+)@([a-zA-Z0-9_\-\.]+)\.([a-zA-Z]{2,5}){1,25})+([;.](([a-zA-Z0-9_\-\.]+)@([a-zA-Z0-9_\-\.]+)\.([a-zA-Z]{2,5}){1,25})+)*$"/>
                        <rich:validator/>
                    </h:inputText>

                    <h:outputLabel for="address" value="${tran.Address}" />
                    <h:inputText id="address" value="#{cardUploadBean.card.address}" />

                    <h:outputLabel for="telephone" value="${tran.Telephone}" />
                    <h:inputText id="telephone" value="#{cardUploadBean.card.telephone}"/>

                    <h:outputLabel for="description" value="${tran.Description}" />
                    <h:inputTextarea id="description" value="#{cardUploadBean.card.description}" />

                </h:panelGrid>
                <h:panelGrid id="imageUpload" columns="1" border="0" style="background-color: #eee">

                    
                    <rich:fileUpload id="frontupload" fileUploadListener="#{cardUploadBean.uploadFront}" maxFilesQuantity="1"
                                     acceptedTypes="jpg,jpeg,png,gif" addLabel="${tran.SelectFront}">
                        <a4j:ajax event="uploadcomplete" execute="@none" render="frontimage" />
                    </rich:fileUpload>

                    <a4j:mediaOutput id="frontimage" element="img" mimeType="image/jpeg"  createContent="#{cardUploadBean.paintFront}"
                                     cacheable="false" styleClass="uploadthumbnail" >
                    </a4j:mediaOutput>

                    <rich:fileUpload id="backupload" fileUploadListener="#{cardUploadBean.uploadBack}" maxFilesQuantity="1"
                                     acceptedTypes="jpg,jpeg,png,gif" addLabel="${tran.SelectBack}"
                            >
                        <a4j:ajax event="uploadcomplete" execute="@none" render="backimage" />
                    </rich:fileUpload>

                    <a4j:mediaOutput id="backimage" element="img" mimeType="image/jpeg" createContent="#{cardUploadBean.paintBack}"
                                     cacheable="false" styleClass="uploadthumbnail">
                    </a4j:mediaOutput>

                </h:panelGrid>
                <rich:jQuery selector="td>img" query="parent().css('text-align','center').css('height','105px')" />
            </h:panelGrid>
            <h:panelGrid id="panel2" columns="1" border="0" style="width: 100%">
                <h:panelGrid columns="2" border="0">
                    <h:selectBooleanCheckbox id="public" value="#{cardUploadBean.card.publicVisibility}"/>
                    <h:outputLabel for="public" value="${tran.ShouldCardBePublic}" />
                </h:panelGrid>


                <h:outputText value="${tran.AddCardToCategories}" />
                <div class="categories">
                    <a4j:outputPanel ajaxRendered="true" id="addCardCategories">
                        <rich:messages ajaxRendered="true" for="cardForm:addCardCategories"/>
                        <h:panelGrid columns="2" border="0">

                            <ui:repeat value="#{cardUploadBean.categories}" var="cat" varStatus="status">
                                <div class="nnumber">
                                    <h:inputText styleClass="nnumber" value="#{cat.path2root}" readonly="true"/>
                                    &nbsp;
                                    <a4j:commandButton value="${tran.Delete}" action="#{cardUploadBean.deleteCategory(status.index)}"/>
                                </div>
                            </ui:repeat><br/>

                            <rich:select clientFilterFunction="customFilter"
                                         id="rfSelectCategorySelector2"
                                         styleClass="categoryCombo"
                                         listClass="categoryComboList"
                                         enableManualInput="true"
                                         defaultLabel="select category"
                                         value="#{cardUploadBean.currentCategory}"
                                    >
                                <f:attribute name="selectItems" value="#{categoryBean.selectItems['categories_wrapped']}"/>
                                <f:selectItems value="#{categoryBean.selectItems['categories_wrapped']}" itemLabelEscaped="#{false}" />
                            </rich:select>
                            <input type="button" value="${tran.Clear}" onclick="#{rich:component('rfSelectCategorySelector2')}.setValue('');   " />
                            <a4j:commandButton value="${tran.Add}" action="#{cardUploadBean.addCategory}" disabled="return ((#{rich:component('rfSelectCategorySelector2')}.getValue())!='');" />
                        </h:panelGrid>
                    </a4j:outputPanel>
                </div>

                <f:facet name="footer">
                    <h:panelGroup style="display:block; text-align:center">
                        <h:commandButton action="#{cardUploadBean.addCard}" value="${tran.Save}" />
                        <h:commandButton action="#{cardUploadBean.resetFields}" value="${tran.Clear}" render="panel"/>
                    </h:panelGroup>
                </f:facet>
            </h:panelGrid>
        </rich:graphValidator>
        </div>
    </h:form>

    </div>
</ui:composition>

</html>
