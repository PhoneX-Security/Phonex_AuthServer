<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:sec="http://www.springframework.org/security/tags"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
    <ui:composition>

        <div id="content">
            

            <div id="main">
                <a4j:outputPanel>
                    <rich:messages ajaxRendered="true" />
                    <a4j:status id="ajaxStatus" onstart="#{rich:component('statPane')}.show();" onstop="#{rich:component('statPane')}.hide();" />
                    <rich:popupPanel id="statPane" autosized="true">
                        ${tran.pleaseWait}
                    </rich:popupPanel>
                </a4j:outputPanel>
                
                <h:form id="searchFrom" prependId="false">
                    <h:inputText styleClass="searchInput" value="#{cardBean.searchText}"
                                 required="true" />
                    <a4j:commandButton styleClass="searchButton" value="${tran.Search}"
                                       render="dataGridToRender" execute="@form" />
                    <h:selectBooleanCheckbox value="#{cardBean.onlyUserCards}"
                                             rendered="#{sec:areAnyGranted('ROLE_USER, ROLE_ADMIN')}" />
                    <h:outputText value="${tran.OnlyMyCards}"
                                  rendered="#{sec:areAnyGranted('ROLE_USER, ROLE_ADMIN')}" />
                </h:form>

                <h:form id="myform" prependId="false">
                    <div id="dataGrid">
                        <a4j:outputPanel id="dataGridToRender">
                            <rich:dataGrid id="richDataGrid" columns="3" elements="9"
                                           value="#{cardBean.cards}" var="card">

                                <h:outputText value="#{card.id}" binding="#{cardBean.outputText}"
                                              rendered="false" />

                                <rich:panel header="#{card.firstName} #{card.secondName}"
                                            bodyClass="pbody">

                                    <a4j:outputPanel  layout="block">
                                        <h:commandButton  styleClass="card"
                                                          image="img/#{cardBean.renderedCardSmallImage}"
                                                          action="#{cardBean.selectCard}"
                                                          >
                                            <f:param name="selectedImageId" value="#{card.id}"/>
                                        </h:commandButton>

                                        <!--<a4j:commandButton styleClass="card"
                                                           image="img/#{cardBean.renderedCardSmallImage}"
                                                           >
                                            
                                            <a4j:ajax event="click" execute="@this" render=":out"
                                                    listener="#{cardBean.selectCard}" />
                                            
                                            <a4j:param name="selectedImageId" value="#{card.id}" />
                                        </a4j:commandButton>-->
                                    </a4j:outputPanel>
                                </rich:panel>

                            </rich:dataGrid>
                        </a4j:outputPanel>
                        <rich:dataScroller for="richDataGrid" maxPages="10"
                                           id="scrollerContainer" fastStep="2">
                            <f:facet name="first">
                                <h:outputText value="${tran.First}" />
                            </f:facet>
                            <f:facet name="last">
                                <h:outputText value="${tran.Last}" />
                            </f:facet>
                        </rich:dataScroller>
                    </div>
                </h:form>
            </div>



            <div id="column">
                <a4j:outputPanel id="out" layout="block">
                    <rich:panel>                        
                        <rich:panel  id="picture" rendered="#{!cardBean.renderedSelected}">
                            <h:outputText value="${tran.IntroHelp}" />
                            <!--<h:graphicImage styleClass="bigCard"
                                            value="img/#{cardBean.selectedCardMediumImage}" />-->
                        </rich:panel>
                        
                        <h:form rendered="#{cardBean.renderedSelected}" id="form">
                            <h:panelGrid columns="1" styleClass="calign">
                                <h:panelGrid columns="1" id="repeat">                                    
                                    <a4j:repeat rows="1"  value="#{cardBean.selectedCardMediumImages}" var="pic" id="pics">
                                        <h:graphicImage styleClass="bigCard" value="img/#{pic}" />
                                    </a4j:repeat>                                    
                                </h:panelGrid>
                                <rich:dataScroller for="pics" id="ds" render="repeat" stepControls="hide" boundaryControls="hide"
                                    fastControls="hide" maxPages="10" />
                            </h:panelGrid>
                        </h:form>

                        <rich:panel id="buttons" rendered="#{cardBean.canEditSelected}">
                            <h:form id="editCard">
                                <h:commandButton value="${tran.change}" action="/card.xhtml">
                                    <f:param name="action" value="edit" />
                                    <f:param name="id" value="#{cardBean.selectedCard.id}" />
                                    <h:inputHidden id="editId" value="#{cardBean.selectedCard.id}" />
                                </h:commandButton>
                            </h:form>

                            <h:form id="cardDeleteForm">
                                <!--<h:commandLink value="Delete" action="#{cardUploadBean.deleteCard(cardBean.selectedCard)}"/>-->
                                <a4j:commandButton styleClass="no-decor" execute="@this" render="@none"
                                                   oncomplete="#{rich:component('confirmPane')}.show()" value="${tran.Delete}">
                                    <a4j:param name="id" value="#{cardBean.selectedCard.id}" />
                                </a4j:commandButton>
                            </h:form>    
                        </rich:panel>

                        <rich:panel id="list" rendered="#{cardBean.renderedSelected}">
                            <rich:list value="#{cardBean.cardInfo}" var="cardInfoList"
                                       type="unordered">
                                <h:outputText value="#{cardInfoList.info}" />
                            </rich:list>
                        </rich:panel>
                    </rich:panel>

                    <a4j:jsFunction name="remove" action="#{cardBean.remove}" render="table" execute="@this"
                                    oncomplete="#{rich:component('confirmPane')}.hide();" />


                    <rich:popupPanel id="confirmPane" autosized="true">
                        ${tran.AreYouSureToDelete}
                        <a4j:commandButton value="${tran.Cancel}" onclick="#{rich:component('confirmPane')}.hide(); return false;" />
                        <a4j:commandButton value="${tran.Delete}" onclick="remove(); return false;" />
                    </rich:popupPanel>

                </a4j:outputPanel>
            </div>

            <div class="clear"></div>

        </div>

        <!-- content -->
    </ui:composition>

</html>
